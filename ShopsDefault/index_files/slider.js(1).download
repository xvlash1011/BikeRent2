var is_typing,sto_typing,myscroll="",is_send_typing=!0,vtChatCount=0;_checkFirstMsg=0;var replyWhenBuzy_timeout="",status_boxchat=0,_is_mobile=!1;function isset(a){return!("undefined"==a||null==a||null==a)}function vgc_update_info(){alert("Ch\u1EE9c n\u0103ng n\xE0y kh\xF4ng \u0111\u01B0\u1EE3c cho ph\xE9p t\u1EA1i \u0111\xE2y.")}var vgc_chatbot={chose_opt:function(a){var b=$(a).data("ans")||"",c=$(a).data("quest")||"",d=$(a).data("id")||0,e=$(a).data("index")||0;vgc_chatbot.send_opt({quest:c,bot_id:d,bot_id_opt:e}),$("#box_chatbot_cbi").val(0),$("#box_chatbot_cbi_opt").val(0)},send_quest:function(a){var b=$(a).data("id")||0,c=$(a).data("quest")||"";vgc_chatbot.send_opt({quest:c,bot_id:b}),$("#box_chatbot_cbi").val(0),$("#box_chatbot_cbi_opt").val(0)},send_opt:function(a){var b=a.quest||"",c=a.bot_id||0,d=a.bot_id_opt+1||0;$("#box_text_send").val(b),$("#box_chatbot_cbi").val(c),$("#box_chatbot_cbi_opt").val(d),embedFunction.send("","send")}},embedFunction={init:function(){_is_mobile=embedFunction.detected_mobile()},detected_mobile:function(){var b=!1;return function(c){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(c)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(c.substr(0,4)))&&(b=!0)}(navigator.userAgent||navigator.vendor||window.opera),b},openUrl:function(a){parent.postMessage({action:"openurl",value:a},"*")},toggle_info:function(){$("#topinfo").toggle()},trigger_send_info:function(a,b){var c=b.keyCode?b.keyCode:b.which;13==c&&$(a).next().trigger("click")},trigger_next_info:function(a,b){var c=b.keyCode?b.keyCode:b.which;13==c&&$(a).parents(".r_item_field").find(".r_button_next").trigger("click")},send_contact_info:function(a){var b=$(a).parent().find(".r_text"),c=b.data("name")||"",d=b.val()||"",e="",f="S\u1ED1 \u0111i\u1EC7n tho\u1EA1i ch\u01B0a \u0111\xFAng",g="Email sai \u0111\u1ECBnh d\u1EA1ng",h="B\u1EA1n ch\u01B0a nh\u1EADp c\xE2u tr\u1EA3 l\u1EDDi",j="D\u1EEF li\u1EC7u ch\u01B0a \u0111\u01B0\u1EE3c nh\u1EADp",k="Kh\xE1ch h\xE0ng v\u1EEBa nh\u1EADp Form th\xF4ng tin tr\u01B0\u1EDBc khi chat",l="Tr\u1EA3 l\u1EDDi c\xE2u h\u1ECFi";isset(_lang)&&"en"==_lang_id&&(f="Phone number failed",g="Email failed",h="You not input Answer",j="Data is empty",k="Customers have just entered the pre-chat form",l="Answer the question");var m=$("#box_send_id").val()||"",n=$("#box_hash").val()||"",o=$("#box_to_id").val()||"";client_info_Data={},client_info_Data.guest_id=m,client_info_Data.hash=n,client_info_Data.to_id=o,client_info_Data.quest="",client_info_Data.quest_val="";var p=$(a).parents(".r_item_field").attr("id")||"",q=$("#"+p).next().attr("id")||"";console.log(p,q);var r={name:"",email:"",phone:"",url:"",message:"",address:"",user:m,action:"send_contact"};if(console.log("Field:",c,d),""!=c&&""!=d)switch(c){case"c_phone":9>d.match(/\d/g).length||12<d.match(/\d/g).length?e+=f:isNaN(d)&&(e+=f),client_info_Data.phone=d,r.phone=d;break;case"c_email":var s=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;s.test(d)||(e+=g),client_info_Data.email=d,r.email=d;break;case"c_name":client_info_Data.name=d,r.name=d;break;case"c_address":client_info_Data.address=d,r.address=d;break;case"in_chat_question":if(client_info_Data.quest=$("#text_question").data("quest")||"",client_info_Data.quest_val=$("#text_question").val()||"",console.log(client_info_Data.quest,client_info_Data.quest_val),""==client_info_Data.quest||""==client_info_Data.quest_val)e+=h;else{var t=k+" <br>";""!=client_info_Data.quest&&""!=client_info_Data.quest_val&&(t+=l+" ["+client_info_Data.quest+"]: "+client_info_Data.quest_val),$("#box_text_send").val(t),embedFunction.send("","send")}}else e+=j;if(""==e){console.log("send");parent.postMessage({action:"vchat_api",data:r},"*"),$.post(url_server_vgchat_client+"ajax_client_info_add.php",client_info_Data,function(a){(1==a.status||""==a.error)&&(console.log("vt1",$("#"+p)),$("#"+p).addClass("hide"),""!=q&&(console.log("vt2",$("#"+q)),$("#"+q).removeClass("hide"),$("#"+q).find(".r_text").focus()),"r_thank"==q&&$("#r_title").remove()),console.log("response")},"JSON")}else $(a).parent().next().text(e)},send_message_offline_next:function(a){var b=$(a).parent().find(".r_text"),c=b.data("name")||"",d=b.val()||"",e="",f="S\u1ED1 \u0111i\u1EC7n tho\u1EA1i ch\u01B0a \u0111\xFAng",g="Email sai \u0111\u1ECBnh d\u1EA1ng",h="Ch\u01B0a nh\u1EADp tin nh\u1EAFn",j="Tin nh\u1EAFn qu\xE1 ng\u1EAFn",k="B\u1EA1n ch\u01B0a nh\u1EADp t\xEAn c\u1EE7a b\u1EA1n";switch(isset(_lang)&&"en"==_lang_id&&(f="Phone number failed",g="Email failed",h="The message is empty",j="The message is too short",k="The name is not empty"),c){case"c_name":""==d?e+=k:$("#box_user_name").val(d);break;case"c_email":if(""==d)e+=g;else{var l=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;l.test(d)?$("#box_user_email").val(d):e+=g}break;case"c_phone":""==d?e+=f:9>d.match(/\d/g).length||12<d.match(/\d/g).length?e+=f:isNaN(d)?e+=f:$("#box_user_phone").val(d);break;case"c_message":""==d?e+=error_messagel:5>d.length?e+=j:$("#box_message").val(d);}if(console.log(e),""==e){var m=$(a).parent().attr("id")||"",n=$("#"+m).next().attr("id")||"";""!=m&&$("#"+m).remove(),"r_thank"==n?$(a).next(".r_button_send").trigger("click"):($("#"+n).removeClass("hide"),$("#"+n).find(".r_text").focus())}else return $(a).parent().find(".r_error").text(e),!1},send_message_offline_new:function(a){var b=$(a).parent().find(".r_text"),c=b.data("name")||"",d=b.val()||"",e="",f="S\u1ED1 \u0111i\u1EC7n tho\u1EA1i ch\u01B0a \u0111\xFAng",g="Email sai \u0111\u1ECBnh d\u1EA1ng",h="Ch\u01B0a nh\u1EADp tin nh\u1EAFn",j="Tin nh\u1EAFn qu\xE1 ng\u1EAFn",k="B\u1EA1n ch\u01B0a nh\u1EADp t\xEAn c\u1EE7a b\u1EA1n";switch(isset(_lang)&&"en"==_lang_id&&(f="Phone number failed",g="Email failed",h="The message is empty",j="The message is too short",k="The name is not empty"),c){case"c_email":if(""==d)e+=g;else{var l=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;l.test(d)?$("#box_user_email").val(d):e+=g}break;case"c_phone":""==d?e+=f:9>d.match(/\d/g).length||12<d.match(/\d/g).length?e+=f:isNaN(d)?e+=f:$("#box_user_phone").val(d);}var m=$("#box_user_phone").val()||"",n=$("#box_user_name").val()||"",o=$("#box_user_email").val()||"",p=$("#box_message").val()||"",q=$("#box_send_id").val()||"",r=$("#box_hash").val()||"",s=$("#box_to_id").val()||"",t=$("#box_link").val()||"",u=$("#vgc_address").val()||"";if(""!=m&&""!=p){var v={action:"vchat_api",data:{name:n,email:o,phone:m,url:t,message:p,address:u,user:q,action:"send_message_offline"}};parent.postMessage(v,"*"),console.log("api",v),$(".r_item_field").remove(),$.post("//live.vnpgroup.net/js/aj_chat_contact.php",{vgc_use_name:n,vgc_use_email:o,vgc_use_phone:m,vgc_msg_off:p,vgc_link:t,vgc_estore:s,vgc_myid:q,vgc_address:u},function(a){1==a.status?($("#r_thank").removeClass("hide"),$("#r_title").remove(),setTimeout(function(){embedFunction.callOffline()},4e3)):($("#off_ferror").text(a.error),$("#vgc_er").removeClass("hide"))},"json")}else return $(a).parent().find(".r_error").text(e),!1},get_cookie:function(a){var b="; "+document.cookie,c=b.split("; "+a+"=");if(2==c.length)return c.pop().split(";").shift()},toggle_emoji:function(){$("#emoji_list").toggle(),$("#emoji_list img").each(function(){var a=$(this).data("src");$(this).attr("src",a)})},set_emoji:function(a){var b=$(a).data("key")||"";""!=b&&($("#box_text_send").val(b),embedFunction.send("","send"),this.toggle_emoji())},set_cookie:function(a){var b=new Date,c=a.name||"",d=a.value||"",e=a.expires||"",f=a.type||"d",g=0;g="m"==f?1e3*(60*e):1e3*(60*(60*(24*e))),b.setTime(b.getTime()+g);var h="expires="+b.toUTCString();console.log("set cookie"),document.cookie=c+"="+d+";secure=false; "+h+";path=/; samesite=None; domain=.vnpgroup.net"},callOffline:function(a){parent.postMessage({action:"offlineBig",value:a},"*")},update_status_box:function(a){$("#wet_on").hasClass("un_animation")||(0==a?$("#wet_on").removeClass("icon_on").addClass("icon_mail_off"):$("#wet_on").removeClass("icon_mail_off").addClass("icon_on"))},send_msg_offline:function(a){$("#vgc_er").html("");var b="",c=$("#vgc_link").val()||window.location.href,d=$("#vgc_use_name").val()||"",e=$("#vgc_use_email").val()||"",f=$("#vgc_use_phone").val()||"",g=$("#vgc_msg_off").val()||"",h=$("#vgc_address").val()||"",j="B\u1EA1n ch\u01B0a nh\u1EADp t\xEAn <br>",k="B\u1EA1n ch\u01B0a nh\u1EADp email <br>",l="B\u1EA1n ch\u01B0a nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i <br>",m="B\u1EA1n ch\u01B0a nh\u1EADp tin nh\u1EAFn <br>",n="S\u1ED1 \u0111i\u1EC7n tho\u1EA1i ch\u01B0a \u0111\xFAng <br>",o="Email sai \u0111\u1ECBnh d\u1EA1ng <br>",p="N\u1ED9i dung qu\xE1 ng\u1EAFn <br>";if(isset(_lang)&&"en"==_lang_id){var j=_lang.error_name+"<br>",k=_lang.error_email+"<br>",l=_lang.error_phone+"<br>",m=_lang.error_mes+"<br>";n="Phone number failed <br>",o="Email failed <br>",p="Content is too short <br>"}""==d&&(b+=j);var q=parseInt($("#vgc_use_phone").data("require"))||0,r=parseInt($("#vgc_use_email").data("require"))||0;if(1==q&&(""==f?b+=l:(9>f.match(/\d/g).length||16<f.match(/\d/g).length)&&(b+=n)),1==r)if(""==e)b+=k;else{var s=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;s.test(e)||(b+=o)}if(""==g?b+=m:5>g.length&&(b+=p),""==b){var t={vgc_use_name:d,vgc_use_email:e,vgc_use_phone:f,vgc_msg_off:g,vgc_link:c,vgc_estore:a,vgc_myid:$("#vgc_myid").val(),vgc_address:h};embedFunction.set_cookie({name:"vchat_web_name",value:d,expires:600}),embedFunction.set_cookie({name:"vchat_web_email",value:e,expires:600}),embedFunction.set_cookie({name:"vchat_web_phone",value:f,expires:600}),$(".off_form_item").append("<span style=\"margin-top: 13px;float: left;\" id=\"vgc_loading\">Loading...</span>");parent.postMessage({action:"sendmessage_offline"},"*"),$.post("//live.vnpgroup.net/js/aj_chat_contact.php",t,function(a){1==a.status?($("#vgc_er").html(a.note),$(".vgc_remove").remove(),$(".off_form_title").remove(),setTimeout(function(){embedFunction.callOffline()},4e3)):$("#vgc_er").html(a.error),$("#vgc_loading").fadeOut(300),setTimeout(function(){$("#vgc_loading").remove()},1e3)},"json")}else return $("#vgc_er").html(b),!1},box_big:function(a){parent.postMessage({action:"isBig",value:a},"*")},box_open_omnichanel:function(a){parent.postMessage({action:"isOmnichanel",value:a},"*")},omnichanel_post:function(a){var b,c,d;b=a.send_id||0,c=a.to_id||0,d=a.action||"",(0<b||""!=d||0>=c)&&$.ajax({url:"//live.vnpgroup.net/js/omnichanel_post.php",type:"POST",dataType:"JSON",data:a,async:!1,success:function(a){console.log(a)}})},notifi_count:function(a){var b=$(".wet_noti_count");switch(a){case 0:$(".wet_noti_count").addClass("hide"),b.text(0);break;case 1:var c=parseInt(b.text());b.removeClass("hide"),b.text(c+1);}},status_boxchat:function(a){$("#wet_on").hasClass("un_animation")||(0==a?$("#wet_on").removeClass("icon_on").addClass("icon_off"):$("#wet_on").removeClass("icon_off").addClass("icon_on").focus())},showbox:function(){parent.postMessage({action:"showbox"},"*")},showbox_offline:function(){parent.postMessage({action:"showboxoffline"},"*")},virtual_chat:function(){var a=new Date,b=a.getTime();if("undefined"!=typeof _vc_config.chs_setting_greeting.invite_showbox.template_msg){var c=_vc_config.chs_setting_greeting.invite_showbox.template_msg;if(0<c.data.length){var d,e;d=$("#box_send_id").val()||0,e=$("#box_to_id").val()||0;var f=setInterval(function(){vtChatCount==c.data.length-1&&clearInterval(f),_rowchat={id:0,send_id:d,to_id:e,message:c.data[vtChatCount],link:"",time_str:"V\xE0i gi\xE2y tr\u01B0\u1EDBc",myclass:"row_friend",time:b,ip:"",att_id:"elm_"+(b+1)},vtChatCount++,embedFunction.play_sound(),boxchat._data.chat.push(_rowchat),embedFunction.scroll_boxchat()},5e3)}}},box_message:function(){parent.postMessage({action:"isMessage"},"*")},box_greeting:function(){parent.postMessage({action:"greeting"},"*")},box_eyechat:function(){parent.postMessage({action:"eyechat"},"*")},box_omnichanel:function(){parent.postMessage({action:"omnichanel"},"*")},open_chat:function(a){$.post("api/api_get_template_boxchat.php",{id:a},function(b){if(1==b.status){for(i in $("#web_right").html(b.data),_is_mobile&&$("#web_right").removeClass("hide"),myhistory._data.historys)if(myhistory._data.historys[i].id==a){myhistory._data.historys[i].count=0;break}}else return alert(b.error),!1},"json")},close_box:function(){$("#boxchat").html(""),_is_mobile&&$("#web_right").addClass("hide")},scroll_boxchat:function(){var a=$(".body"),b=a.find(".rowchat:last").outerHeight();setTimeout(function(){a[0].scrollTop=a[0].scrollHeight+b},200)},auto_reply:function(a){var b=a.id||0,c=a.send_id||0;if("undefined"!=typeof _vc_config){var d=_vc_config.chs_setting_autoreply.auto_reply||0;if(0==d)return;var e=parseInt(embedFunction.get_cookie("autoreply_step"))||1;if(2<e)return;var f=_vc_config.chs_setting_autoreply.auto_reply_first,g=_vc_config.chs_setting_autoreply.auto_reply_second;return(""!=f&&(f=f.trim()),""!=g&&(g=g.trim()),1==e&&""==f)||2==e&&""==g?void 0:(setTimeout(function(){_rowautoreplychat={id:0,send_id:b,to_id:c,message:2==e?g:f,link:a.link,time_str:"V\xE0i gi\xE2y tr\u01B0\u1EDBc",myclass:"row_friend",time:a.vgc_time,ip:a.ip,att_id:"elm_"+(a.vgc_time+1)},boxchat._data.chat.push(_rowautoreplychat),embedFunction.play_sound(),embedFunction.scroll_boxchat(),clearTimeout(replyWhenBuzy_timeout)},2500),void embedFunction.set_cookie({name:"autoreply_step",value:e+1,expires:1}))}},keyup_textchat:function(a){var b=$(a),c="",d="";""==b.val().trim()?($(".btn_attach").removeClass("hide"),$(".btn_send").addClass("hide"),$("#btn_call").removeClass("hide"),c="",d="deleting",is_send_typing=!0):($(".btn_attach").addClass("hide"),$(".btn_send").removeClass("hide"),$("#btn_call").addClass("hide"),c=b.val(),d="typing"),is_send_typing&&(clearTimeout(is_typing),is_send_typing=!1,is_typing=setTimeout(function(){var a={};a.msg=b.val(),a.to_id=$("#box_to_id").val(),a.send_id=$("#box_send_id").val(),a.hash=$("#box_hash").val(),a.typing_text=d,embedFunction.typing(a),clearTimeout(is_typing)},500))},typing:function(a){var b={};b.message=a.msg||"",b.to_id=a.to_id,b.send_id=a.send_id,b.hash=a.hash,b.typing_text=a.typing_text,is_send_typing=!1,$.post("//live.vnpgroup.net/js/typing.php",b,function(){"deleting"==a.typing_text&&(is_send_typing=!0),clearTimeout(sto_typing),sto_typing=setTimeout(function(){is_send_typing=!0},3e3)},"json")},send:function(a,b){var c=a.keyCode?a.keyCode:a.which,d=parseInt($("#box_to_id").val())||0,e=$("#box_text_send");if(13==c||"send"==b)if(is_send_typing=!0,""!=e.val().trim()){var f=Math.floor(1e6*Math.random()+1),g={},h=new Date,j=h.getTime();g.message=e.val(),g.to_id=$("#box_to_id").val(),g.to_name=$("#box_to_name").val(),g.send_id=$("#box_send_id").val(),g.send_name=$("#box_send_name").val(),g.pro_id=0,g.hash=$("#box_hash").val(),g.time=0,g.vgc_time=j,count_vgchat=parseInt($("#box_count_vchat").val())||0,g.count_vgchat=count_vgchat,g.vgc_rand=f,g.support_id=$("#box_support_id").val(),g.support_name=$("#box_support_name").val(),g.support_name=$("#box_support_name").val(),g.vgc_chatbot_cbi=$("#box_chatbot_cbi").val(),g.vgc_chatbot_cbi_opt=$("#box_chatbot_cbi_opt").val(),"undefined"!=typeof _vc_link&&(g.link=_vc_link),0<count_vgchat&&$("#box_count_vchat").val(0);var h=new Date,k=h.getHours(),l=h.getMinutes(),m=h.getSeconds();setTimeout(function(){e.val("")},5);parent.postMessage({action:"sendchat"},"*"),$.post("//live.vnpgroup.net/js/send.php",g,function(a){var b=a.msg||"",c=a.error||"";if(""!=c)$("#boxchat_"+d).find(".vgc_alert_error").html(c).removeClass("vgc_hide");else if(""!=b,"undefined"!=typeof _show_in_chat&&1==_show_in_chat&&setTimeout(function(){var a=$("#template_contact").html();$("#logchat").append(a),$("#template_contact").remove(),$($(".r_text")[0]).focus(),embedFunction.scroll_boxchat()},1e3),"undefined"!=typeof _open_client&&1==parseInt(_open_client)&&$("#form_client_info").length&&$("#form_client_info").removeClass("hide"),"undefined"==typeof a.bot&&embedFunction.auto_reply(a),isset(typeof _vc_config.chs_setting_orther.auto_rep_buzy)){var e=parseInt(embedFunction.get_cookie("reply_buzy"))||0,f=_vc_config.chs_setting_orther.auto_rep_buzy.vl,g=_vc_config.chs_setting_orther.auto_rep_buzy.time,h=_vc_config.chs_setting_orther.auto_rep_buzy.text||"",j=_vc_config.chs_setting_autoreply.auto_reply||0,k=parseInt(embedFunction.get_cookie("autoreply_step"))||1;1==j&&3>k&&(f=0);var l=new Date,m=l.getTime();clearTimeout(replyWhenBuzy_timeout),1==f&&3>e&&(clearTimeout(replyWhenBuzy_timeout),replyWhenBuzy_timeout=setTimeout(function(){console.log("Run buzy"),_rowautoreplychat_buzy={id:0,send_id:a.to_id,to_id:a.send_id,message:h,link:"",time_str:"V\xE0i gi\xE2y tr\u01B0\u1EDBc",myclass:"row_friend",time:"",ip:"",att_id:"elm_"+(m+1)},boxchat._data.chat.push(_rowautoreplychat_buzy),embedFunction.scroll_boxchat(),embedFunction.set_cookie({name:"reply_buzy",value:e+1,expires:1})},1e3*g))}},"json")}else e.val(""),setTimeout(function(){e.val("")},5),this.keyup_textchat(e);e.focus()},socket_chat:function(a){console.log(a),"undefined"!=typeof _open_client&&0==parseInt(_open_client)&&"undefined"!=typeof _checkFirstMsg&&0===_checkFirstMsg&&(this.close_client_info(),_checkFirstMsg=1);var b=a.send_id||0,c=a.id||0;if(b==_config.id){if(c!=_config.to_id)return void console.log("To id != config to id");}else if(clearTimeout(replyWhenBuzy_timeout),b!=_config.to_id)return void console.log("Send id != config to id");var d=a.bot||"";if(""!=d){var e=jQuery.parseJSON(d);0<Object.keys(e).length&&(_rowbotchat={id:0,send_id:a.id,to_id:a.send_id,message:e.html,link:a.link,time_str:"V\xE0i gi\xE2y tr\u01B0\u1EDBc",myclass:"row_friend",time:a.vgc_time,ip:a.ip,att_id:"elm_"+(a.vgc_time+1)},setTimeout(function(){boxchat._data.chat.push(_rowbotchat),embedFunction.play_sound(),embedFunction.scroll_boxchat()},2500))}var f=new Date,g=f.getHours(),h=f.getMinutes(),j=f.getSeconds(),k="row_me",l={};b!=_config.id&&(k="row_friend"),"undefined"!=typeof a.tranfer&&1==a.tranfer&&($("#box_support_id").val(a.support_id),a.msg="Cu\u1ED9c chat c\u1EE7a b\u1EA1n \u0111\u01B0\u1EE3c chuy\u1EC3n cho m\u1ED9t h\u1ED7 tr\u1EE3 kh\xE1c",k="row_friend"),"undefined"!=typeof a.banned&&1==a.banned&&($("#textchat").append("<p class=\"banned_msg\">Cu\u1ED9c chat c\u1EE7a b\u1EA1n v\xEC l\xFD do n\xE0o \u0111\xF3 \u0111\xE3 b\u1ECB ch\u1EB7n t\u1EEB h\u1ED7 tr\u1EE3 vi\xEAn</p>"),$("#box_text_send").remove(),$(".btn_form").remove(),a.msg="Cu\u1ED9c chat c\u1EE7a b\u1EA1n v\xEC l\xFD do n\xE0o \u0111\xF3 \u0111\xE3 b\u1ECB ch\u1EB7n t\u1EEB h\u1ED7 tr\u1EE3 vi\xEAn",k="row_friend");var m=a.ask_location||0;if(m&&(a.msg="Ch\u1EE7 website g\u1EEDi m\u1ED9t y\xEAu c\u1EA7u xin v\u1ECB tr\xED hi\u1EC7n t\u1EA1i c\u1EE7a b\u1EA1n <br><br><button onclick=\"embedFunction.call_send_location()\">Chia s\u1EBB v\u1ECB tr\xED hi\u1EC7n t\u1EA1i</button>"),l={id:a.msg_id,send_id:a.send_id,to_id:a.id,message:a.msg,link:a.link,time_str:"V\xE0i gi\xE2y tr\u01B0\u1EDBc",myclass:k,time:a.vgc_time,ip:a.ip,att_id:"elm_"+a.vgc_time},0>=$("#elm_"+a.vgc_time).length&&boxchat._data.chat.push(l),0==status_boxchat){var n="Tr\u1EA3 l\u1EDDi t\u1EEB";isset(typeof _lang_id)&&"vi"!=_lang_id&&(n="Replying from");var o={title:n+" <b>"+a.support_name+"</b>",msg:a.msg,action:"showMessageWhenHideBox"};if(parent.postMessage(o,"*"),b!=_config.id){parent.postMessage({action:"notifi_count",status:1},"*")}}embedFunction.play_sound(),embedFunction.scroll_boxchat()},play_sound:function(){"undefined"!=typeof _sound_open&&1==_sound_open&&(console.log($("#vgc_sound")),$("#vgc_sound")[0].play())},add_chat_default:function(a){var b=a.msg||"";$("#box_text_send").val(b)},add_greeting_chat:function(a){var b=new Date,c=parseInt(b.getTime()/1e3);_rowgreetchat={id:0,send_id:a.send_id,to_id:a.to_id,message:a.msg,link:"",time_str:"V\xE0i gi\xE2y tr\u01B0\u1EDBc",myclass:"row_friend",time:c,ip:"",att_id:"elm_"+(c+1)},boxchat._data.chat.push(_rowgreetchat),embedFunction.scroll_boxchat()},exit_conversation:function(){$.post(url_server_vgchat_client+"exit_conversation.php",function(a){var b={action:"Re_callFullChat",gid:a.id};parent.postMessage(b,"*")},"JSON")},close_client_info:function(){$("#form_client_info").remove(),"undefined"!=typeof _open_client&&(_open_client=0)},updateContact:function(){var a=$("#s_name").val()||"",b=$("#s_email").val()||"",c=$("#s_phone").val()||"",d=$("#s_address").val()||"",e=$("#vgc_client_info .poll_load"),f=$("#box_send_id").val()||"",g=$("#box_hash").val()||"",h=$("#box_to_id").val()||"",j=$("#question").val()||"",k=$("#question").data("quest")||"",l=$("#client_error"),m="B\u1EA1n ch\u01B0a nh\u1EADp t\xEAn <br>",n="B\u1EA1n ch\u01B0a nh\u1EADp email <br>",o="B\u1EA1n ch\u01B0a nh\u1EADp s\u1ED1 \u0111i\u1EC7n tho\u1EA1i <br>",p="B\u1EA1n ch\u01B0a nh\u1EADp n\u1ED9i dung tin nh\u1EAFn <br>",q="B\u1EA1n ch\u01B0a nh\u1EADp \u0111\u1ECBa ch\u1EC9 <br>",r="Email kh\xF4ng \u0111\xFAng \u0111\u1ECBnh d\u1EA1ng<br>",s="B\u1EA1n ch\u01B0a tr\u1EA3 l\u1EDDi c\xE2u h\u1ECFi c\u1EE7a ch\u1EE7 website <br>",t="S\u1ED1 \u0111i\u1EC7n tho\u1EA1i kh\xF4ng \u0111\xFAng \u0111\u1ECBnh d\u1EA1ng<br>";isset(_lang)&&"en"==_lang_id&&(m=_lang.error_name+"<br>",n=_lang.error_email+"<br>",o=_lang.error_phone+"<br>",p=_lang.error_mes+"<br>",q=_lang.error_address+"<br>",r="Email invalidate<br>",s="You have not answered questions of website owners <br>",t="Phone invalidate<br>");var u="";if($("#form_client_info .client_input").each(function(){var a=$(this).data("type")||"str",b=$(this).val()||"",c=$(this).data("require")||0,d=$(this).data("name")||0;if(1==c&&""==b&&("email"===a?u+=n:"name"===a?u+=m:"phone"===a?u+=o:"address"===a?u+=q:"quest"===a?u+=s:void 0),""!=b)switch(a){case"email":var e=/^([\w-]+(?:\.[\w-]+)*)@((?:[\w-]+\.)*\w[\w-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$/i;e.test(b)||(u+=r);break;case"phone":/[0-9 -()+]+$/;(9>b.match(/\d/g).length||16<b.match(/\d/g).length)&&(u+=t);}}),""!=u)return l.html(u),!1;l.html(""),client_info_Data={},client_info_Data.name=a,client_info_Data.phone=c,client_info_Data.address=d,client_info_Data.guest_id=f,client_info_Data.hash=g,client_info_Data.to_id=h,client_info_Data.email=b,client_info_Data.quest_val=j,client_info_Data.quest=k;$("#box_send_name").val(a+" - "+c);parent.postMessage({action:"sendcontact"},"*");parent.postMessage({action:"vchat_api",data:{name:a,email:b,phone:c,url:"",message:"",address:d,user:f,action:"send_contact"}},"*"),$.post(url_server_vgchat_client+"ajax_client_info_add.php",client_info_Data,function(a){if(1==a.status||""==a.error){embedFunction.close_client_info();var b="Kh\xE1ch h\xE0ng v\u1EEBa nh\u1EADp Form th\xF4ng tin tr\u01B0\u1EDBc khi chat <br>";""!=client_info_Data.name&&(b+="T\xEAn kh\xE1ch: "+client_info_Data.name+"<br>"),""!=client_info_Data.phone&&(b+="S\u1ED1 \u0111i\u1EC7n tho\u1EA1i: "+client_info_Data.phone+"<br>"),""!=client_info_Data.email&&(b+="Email: "+client_info_Data.email+"<br>"),""!=client_info_Data.address&&(b+="\u0110\u1ECBa ch\u1EC9: "+client_info_Data.address+"<br>"),""!=k&&""!=j&&(b+="Tr\u1EA3 l\u1EDDi c\xE2u h\u1ECFi ["+k+"]: "+j),$("#box_text_send").val(b),embedFunction.send("","send")}else l.html(a.error)},"JSON")},send_file:function(a,b){var c=b.id||0,d=document.getElementById("vgc_box_frm_img"),e=document.getElementById("vgc_upload_img"),f=e.files,g=new FormData($(a).parent()[0]),h=f[0];g.append("picture",h,h.name);var j=new XMLHttpRequest;return j.open("POST","//vchat.vn/service/upload_image.php",!0),j.onload=function(a){if(200===j.status){var a=JSON.parse(j.responseText);if(""!=a.error)return alert(a.error),!1;""!=a.data&&($("#box_text_send").val(a.data),embedFunction.send("","send"))}else return alert("G\u1EB7p l\u1ED7i trong qu\xE1 tr\xECnh truy\u1EC1n file!"),!1},j.send(g),!1},call_send_location:function(){parent.postMessage({action:"send_location"},"*")},select_opt_list:function(a){var b=$(a).data("value")||"";""!=b&&$("#question").val(b)},select_opt_list_in_chat:function(a){var b=$(a).data("value")||"";""!=b&&$("#text_question").val(b)}};window.addEventListener("message",function(a){var b=a.data.stype||"";if(""!=b)switch(b){case"status_boxchat":var c=a.data.status_boxchat;status_boxchat=c;break;case"showbox":$("#wet_on").trigger("click");break;case"showboxoffline":$("#wet_on").trigger("click");}}),setTimeout(function(){embedFunction.init()},100);